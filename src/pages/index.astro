---
import { getCollection } from 'astro:content';
import BaseLayout from '~/layouts/BaseLayout.astro';
import Header from '~/components/Header.astro';
import About from '~/components/About.astro';
import Hr from '~/components/Hr.astro';
import Extract from '~/components/Extract.astro';
import Footer from '~/components/Footer.astro';

export const prerender = true;

const posts = await getCollection('blog');

// Parse date strings like "05 Dec 25" or "24th Nov 24" into Date objects
function parseDate(dateStr: string): Date {
	const cleaned = dateStr.replace(/(\d+)(st|nd|rd|th)/, '$1');
	const [day, month, year] = cleaned.split(' ');
	const fullYear = parseInt(year) + 2000;
	return new Date(`${day} ${month} ${fullYear}`);
}

// Sort posts by date (newest first)
const sortedPosts = posts.sort((a, b) => {
	return parseDate(b.data.date).getTime() - parseDate(a.data.date).getTime();
});
---

<BaseLayout title="Kyle Harper" description="Kyle Harper, Product Engineer">
	<div>
		<Header />

		<main>
			<h1>Kyle Harper</h1>
			<About />
		</main>

		<Hr />

		<aside>
			<h2 class="mt-0">Blog</h2>
			{
				sortedPosts.map((post) => (
					<Extract
						title={post.data.title}
						date={post.data.date}
						intro={post.data.intro}
						href={`/blog/${post.slug}`}
					/>
				))
			}
		</aside>

		<Footer />
	</div>
</BaseLayout>
